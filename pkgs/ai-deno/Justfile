set windows-shell := ["powershell", "-c"]

build:
    cargo clean -p ai-deno
    yarn tsup src/js/src/main.ts --outDir src/js/dist --format esm
    cargo build --release

[windows]
watch:
    cargo clean -p ai-deno -p deno_core
    powershell -Command "Start-Process -NoNewWindow just -ArgumentList 'watch-js'; cargo watch --clear -x 'build --release'"

[unix]
watch:
    cargo clean -p ai-deno -p deno_core
    just watch-js & cargo watch --clear  -x "build --release"

[unix]
watch-example:
    cargo watch --clear  -x "run example"

[unix]
show-externs:
    nm -m target/release/libai_deno.a

watch-js:
    yarn tsup src/js/src/main.ts --outDir src/js/dist --format esm --watch

build-js:
    yarn tsup src/js/src/main.ts --outDir src/js/dist --format esm
